source("setup.R")

park <- "BRCA"

park_dat <- "data/park/"

if(!dir.exists(paste0(getwd(), "/", park_dat,"/", park))){dir.create(paste0(getwd(), "/", park_dat, "/", park), showWarnings = FALSE)}

# get pack boundary
unit <- getParkBoundary(park = park, save = TRUE, path = "data/park/")

# buffer outside park
buffer <- unit %>%
  sf::st_buffer(., dist = 0.1)

# download aquarius data
Aquarius <- getAquarius(park = park, path = park_dat, system = "Mac")

Aquifers <- getAquifers(aoi = buffer, save = TRUE, path = park_dat)

Buildings <- getBuildings(aoi = buffer, dist = 0)

# not working:
DataStoreList <- listDataStore(park = park, max = 1000, save = TRUE, path = park_dat)
# cannot test:
DataStore <- getDataStore()

GWRecharge <- getGWRecharge(aoi = buffer, dist = 0)

# get noaa data
NOAA <- getNOAA(aoi = buffer, park = park, save = TRUE, path = paste0(path, "/", park, "/"),
                    startDate = "1969-01-01", endDate = "2023-12-31")

NPDES <- getNPDES(aoi = buffer, dist = 0)

# find nwis sites
NWISlist <- listNWIS(aoi = buffer, dist = 0)  %>%
  dplyr::mutate(site_type = ifelse(is.na(site_type), "Other", site_type)) %>%
  dplyr::filter(data_type != "Water Quality") %>%
  dplyr::filter(!is.na(code)) %>%
  write_csv(paste0(path, "/", park, "/NWIS_inventory.csv"))

# ***download NWIS data based on nwis site ids
getNWIS(inventory = NWISlist, park = park, path = park_dat, endDate = "2023-12-31", startDate = "1900-01-01")

OmernikII <- getOmernikII(aoi = buffer, save = TRUE, path = paste0(path, "/", park, "/"))

ParkingLots <- getParkingLots(aoi = buffer, dist = 0)

# get NPS system visitation
ParkwideVisitation <- getParkwideVisitation(startYear = 1969, endYear = 2023)

SNOTEL <- getSNOTEL(aoi = buffer, dist = 0, years = 1969:2023,
          timeseries = "Daily", save = TRUE, path = paste0(path, "/", park, "/"))

Springs <- getSprings(park = park, aoi = buffer, system = "Mac", sites = TRUE)

# get park visitation
UnitVisitation <- getUnitVisitation(units = park, startYear = 1969, endYear = 2023) %>%
  mutate(MY = lubridate::ym(paste0(Year,"-",Month)))

# get nhd watersheds
Watersheds <- getWatersheds(aoi = buffer, save = TRUE, path = paste0(path, "/", park, "/"))

# get utah points of diversion
PODUtah <- getPODUtah(aoi = buffer, dist = 0) %>%
  dplyr::mutate(GPM = CFS * 448.8309375)

# get a list if water suppliers in utah, and their WRID
WaterSuppliersUtah <- getWaterSuppliersUtah(aoi = buffer, dist = 0) 

# ***get use info for a water supplier. (based on their WRID)
WaterUseUtah <- getWaterUseUtah(WRID = 1258)