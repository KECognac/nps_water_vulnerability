#test code for grabbing weather station data for getWeather function
library(tidyverse)
library(sf)
library(tmap)
tmap_mode("view")
library(rnoaa)

options(noaakey = "VAOckuKZRAFPIOuippCpMBAUPTiAtVMn")


#run test with JOTR
source("src/getParkBoundary.R")

park <- getParkBoundary("JOTR")


sf::sf_use_s2(FALSE)

# add buffer around area of interest
aoi <- park %>% 
  sf::st_buffer(dist = 0)

bbox <- sf::st_bbox(aoi[i]) %>%
  as.vector() %>%
  round(., digits=7) %>% 
  paste(collapse = ",")


qtm(park) + qtm(aoi)
#just use park boundary for now

# NOAA weather stations ------------------------------------------

# need to get all stations, and then filter those within polygon

ghcnd_all <- ghcnd_stations()

#convert to spatial
ghcnd_spatial <- st_as_sf(ghcnd_all, coords = c("longitude", "latitude"), crs = 4326) %>% 
  st_transform(st_crs(park))

#filter to park
ghcnd_park <- st_filter(ghcnd_spatial, park)
# add option to filter stations/vars that are logged up to a certain year?

#get weather data for all stations (depending on dates this can take a while)
weather_data <- meteo_pull_monitors(ghcnd_park$id, date_min = "2015-10-01",
                                    date_max = Sys.Date())


# SNOTEL ---------------------------------------------------------



