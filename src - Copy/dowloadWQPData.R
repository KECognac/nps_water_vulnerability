
downloadWQPData <- function(sites, save=F, path) {
  
  sites <- sites
    # distinct(.,.keep_all=TRUE) %>%
    # rename(MonitoringLocationIdentifier=1,
    #        OrganizationFormalName=2,
    #        MonitoringLocationTypeName=3,
    #        datum=4,                      
    #        within_park=5,
    #        UNIT_CODE=6,
    #        geometry=7)
  
  site <- sites$MonitoringLocationIdentifier
  
  siter <- function(wqp_data_union){
    
    lister <- function(site){
      
      sites <- sites %>%
        dplyr::filter(MonitoringLocationIdentifier==site)
      
      samples <- dataRetrieval::readWQPdata(siteid=sites$MonitoringLocationIdentifier) %>%
        mutate(across(everything(), as.character))
      
    }
  
    scat <- purrr::map_dfr(wqp_data_union, lister)
  
}

  wqp_data <- sites %>% 
    dplyr::mutate(dat=map(MonitoringLocationIdentifier, siter)) %>%
    select(-c(MonitoringLocationIdentifier,OrganizationFormalName)) %>%
    tidyr::unnest(cols=dat)
  
  if(save == TRUE)
  {write.csv(wqp_data, paste0(path,'/wqp_samples.csv'))}
  
  return(wqp_data)
  
}  