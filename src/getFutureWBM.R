getFutureWBM <- function(park, aoi, macas, wb_vars = c("soil_water", "runoff", "rain", "accumswe", "PET", "Deficit", "AET"), path = "data/park/"){

  sf::sf_use_s2(FALSE)

  if(!dir.exists(paste0(getwd(),"/templeod_dataall/"))){dir.create(file.path(getwd(),"/templeod_dataall/"), showWarnings = FALSE)}
  if(!dir.exists(paste0(getwd(),"/", path, "/", park, "/wbm/"))){dir.create(file.path(paste0(getwd(),"/", path, "/", park, "/wbm/")), showWarnings = FALSE)}

  years <- 2023:2060

  wb_vars <- c("soil_water", "runoff", "rain", "accumswe", "PET", "Deficit", "AET")

  macas <- c("rcp85-MIROC5", "rcp45-CanESM2")

  map_dat <- tidyr::crossing(years, wb_vars, macas) %>%
    mutate(full = macas) %>%
    tidyr::separate(., macas, into=c("rcp","maca"), sep = c("-"))

  start <- Sys.time()

  for(i in 1:nrow(map_dat)){
                   #http://www.yellowstone.solutions/thredds/fileServer/daily_or_monthly/gcm/rcp45/CanESM2/V_1_5_1969_CanESM2_rcp45_accumswe_monthly.nc4
    #              "http://www.yellowstone.solutions/thredds/fileServer/daily_or_monthly/gcm/rcp85/NorESM1-M/V_1_5_2023_NorESM1-M_rcp85_AET_monthly.nc4"
    call <- paste0("http://www.yellowstone.solutions/thredds/fileServer/daily_or_monthly/gcm/",
                   map_dat$rcp[i], "/", map_dat$maca[i], "/V_1_5_",
                   map_dat$years[i], "_", map_dat$maca[i], "_", map_dat$rcp[i], "_", map_dat$wb_vars[i], "_monthly.nc4")

    temp1 <- tempfile()
    download.file(paste0(call), destfile = "templeod_dataall/data.nc4")#, method = "curl")


    wb_crop <- terra::rast("templeod_dataall/data.nc4")

    aoi <- aoi %>%
      sf::st_transform(terra::crs(wb_crop))

    wb_crop <- wb_crop %>%
      terra::crop(aoi, mask = TRUE)

    terra::writeRaster(wb_crop, filename = paste0(getwd(), "/", path, "/", park, "/wbm/",
                                                  park, "_", map_dat$full[i], "_", map_dat$wb_vars[i], "_", map_dat$years[i], ".tif"),
                       overwrite = TRUE)
  }

  end <- Sys.time()

  end - start
  
  unlink("templeod_dataall")
}