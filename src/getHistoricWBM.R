getHistoricWBM <- function(park, aoi, path = "data/park/", wb_vars = c("soil_water", "runoff", "rain", "accumswe", "PET", "Deficit", "AET")
) {
  
  sf::sf_use_s2(FALSE)
  
  if(!dir.exists(paste0(getwd(),"/templeod_dataall/"))){dir.create(file.path(getwd(),"/templeod_dataall/"), showWarnings = FALSE)}
  if(!dir.exists(paste0(getwd(),"/", path, "/", park, "/wbm_hist/"))){dir.create(file.path(paste0(getwd(),"/", path, "/", park, "/wbm_hist/")), showWarnings = FALSE)}
  
  years <- 1980:2022
  
  map_dat <- tidyr::crossing(years, wb_vars)
  
  start <- Sys.time()
  
  for(i in 1:nrow(map_dat)){
    #http://www.yellowstone.solutions/thredds/fileServer/daily_or_monthly/v2_historical/gridmet_v_1_5_historical/V_1_5_2022_gridmet_historical_rain.nc4
        call <- paste0("http://www.yellowstone.solutions/thredds/fileServer/daily_or_monthly/v2_historical/gridmet_v_1_5_historical/V_1_5_", 
                       map_dat$years[i], "_gridmet_historical_", map_dat$wb_vars[i], "_monthly.nc4")
  
    temp1 <- tempfile()
    download.file(paste0(call), destfile = "templeod_dataall/data.nc4")#, method = "curl")
    
    
    wb_crop <- terra::rast("templeod_dataall/data.nc4")
    
    aoi <- aoi %>%
      sf::st_transform(terra::crs(wb_crop))
    
    wb_crop <- wb_crop %>%
      terra::crop(aoi, mask = TRUE)
    
    terra::writeRaster(wb_crop, filename = paste0(getwd(), "/", path, "/", park, "/wbm_hist/",
                                                  park, "_", map_dat$wb_vars[i], "_", map_dat$years[i], ".tif"),
                       overwrite = TRUE)
  }
  
  end <- Sys.time()
  
  end - start
  
  unlink("templeod_dataall")
}