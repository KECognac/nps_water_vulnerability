#### Download NHD High Resolution data
getNHDPlusHR <- function(){

hucs <- c("01","02","03","04","05","06","07","08","09","10",
          "11","12","13","14","15","16","17","18","19","20",
          "21","22")

for(i in 1:length(hucs)){
  nhdplusTools::download_nhdplushr('data/nhdplushr/',
                                   hucs[i], 
                                   download_files = TRUE)
}

# Did all the hucs download?
hucs_test <- as_tibble(sort(c("0104","0106","0107","0108","0202","0415","1501","1407","1502","1505",
                              "1503","1506","0317","0315","0603","1102","1402","1401","1403","1405",
                              "1406","1404","1301","1408","1019","1018","0204","0314","0310","0308",
                              "0307","0309","0306","0313","2001","2002","2006","2005","2201","0602",
                              "0512","0404","0514","0708","0706","1107","0604","1026","1029","1027",
                              "0513","0511","0510","1103","0402","0405","0406","0806","0801","0410",
                              "0318","0316","0505","0305","0304","0601","0302","0303","0301","1011",
                              "1013","1006","1017","1015","1606","1809","1602","0203","1024","1302",
                              "1504","1108","1305","1306","1104","0412","0414","0110","0411","0506",
                              "0504","0508","0509","0207","0502","0208","1908","1101","0804","1111",
                              "1807","1805","1801","1804","1806","1802","1803","1704","1706","0713",
                              "0714","0809","0808","0803","0805","1114","0109","0206","0102","0103",
                              "0105","0904","1002","1701","1008","1007","1003","1113","1710","1707",
                              "1708","1709","2101","1012","1016","1109","1014","1202","1203","1209",
                              "1206","1304","1307","1308","1210","1211","2102","1603","1702","1711",
                              "0703","0704","0403","0401","0311","0312")))

nhdhr <-  as_tibble(list.files('data/nhdplushr/', pattern="*.gdb", recursive = TRUE) %>%
                      str_sub(., 14, 17) %>% unique())

missing <- hucs_test %>% filter(!value %in% nhdhr$value) %>%
  .$value

# ... if not, attempt to download again:
for(i in 1:length(missing)){
  try(nhdplusTools::download_nhdplushr(work_dir,
                                       missing[i], 
                                       download_files = TRUE))
}

}